<!-- Structure HTML améliorée pour Twitchess -->
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twitchess - Échecs Interactifs</title>
    
    <!-- CSS -->
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    <link rel="stylesheet" href="css2/main.css">
    <link rel="stylesheet" href="css2/components/fixes.css"> <!-- Nouvelles corrections -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="css2/components/modal-fix.css">
            <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
          <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="js/chessboard-arrows.js"></script>


</head>
<body data-team="w">
    
    <!-- Conteneur Principal avec Grid Layout -->
    <div class="main-container">
        
        <!-- Panneau Gauche : Historique des Coups -->
        <div class="left-panel">
            <!-- Historique des coups -->
            <div class="moves-history-container">
                <div class="moves-history-header">
                    <i class="fas fa-chess"></i> Historique des Coups
                </div>
                <div class="moves-list" id="movesList">
                    <!-- Les coups seront ajoutés ici dynamiquement -->
                    <!-- Exemple de structure :
                    <div class="move-row">
                        <span class="move-number">1.</span>
                        <span class="move-white">e4</span>
                        <span class="move-black">e5</span>
                    </div>
                    -->
                </div>
            </div>
            
            <!-- Info du problème (si mode problème) -->
            <div id="probleminfo" style="display: none;">
                <h3>Informations du Problème</h3>
                <div class="info-row">
                    <span class="info-label">ID:</span>
                    <span class="info-value" id="problemId">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Rating:</span>
                    <span class="info-value" id="problemRating">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Thèmes:</span>
                    <span class="info-value" id="problemThemes">-</span>
                </div>
            </div>
        </div>
        
        <!-- Zone Centrale : Échiquier -->
        <div id="board_wrapper">
            <!-- Timer Countdown -->
            <div class="countdown showTimer">
                <svg viewBox="0 0 100 100">
                    <circle r="45" cx="50" cy="50" fill="transparent" stroke="#333" stroke-width="5"/>
                    <circle r="45" cx="50" cy="50" fill="transparent" stroke="#667eea" stroke-width="5"
                            stroke-dasharray="283" stroke-dashoffset="0"
                            stroke-linecap="round" transform="rotate(-90 50 50)"/>
                </svg>
                <!-- Le temps sera affiché via CSS ::after -->
            </div>
            
            <!-- Canvas pour dessins -->
            <canvas id="primary_canvas" width="630" height="630"></canvas>
            <canvas id="drawing_canvas" width="630" height="630"></canvas>
            
            <!-- Échiquier ChessboardJS -->
            <div id="myBoard"></div>
            
            <!-- Arc-en-ciel décoratif (optionnel) -->
            <ul class="c-rainbow">
                <li class="c-rainbow__layer c-rainbow__layer--white"></li>
                <li class="c-rainbow__layer c-rainbow__layer--orange"></li>
                <li class="c-rainbow__layer c-rainbow__layer--red"></li>
                <li class="c-rainbow__layer c-rainbow__layer--violet"></li>
                <li class="c-rainbow__layer c-rainbow__layer--blue"></li>
                <li class="c-rainbow__layer c-rainbow__layer--green"></li>
                <li class="c-rainbow__layer c-rainbow__layer--yellow"></li>
            </ul>
        </div>
        
        <!-- Panneau Droit : Votes et Graphiques -->
        <div class="right-panel">
            <!-- Graphique des votes Chart.js -->
            <div class="chart-container">
                <div class="chart-header">
                    <i class="fas fa-poll"></i> Votes en Direct
                </div>
                <canvas id="pollChart"></canvas>
            </div>
            
            <!-- Options de vote (si mode vote) -->
            <div id="votingContainer" class="voting-container" style="display: none;">
                <div class="voting-header">
                    <h3 class="voting-title">Votez pour le Prochain Coup</h3>
                    <div class="voting-timer" id="votingTimer">30s</div>
                </div>
                <div class="voting-options" id="votingOptions">
                    <!-- Options ajoutées dynamiquement -->
                </div>
                <div class="voting-stats">
                    <span>Total: <span id="totalVotes">0</span> votes</span>
                </div>
            </div>
        </div>
    </div>
        <form id="configForm">
        <span id="openFormButton2" style="position: absolute;right: 10px;top: 10px;cursor: pointer;"><i class="fas fa-cog"></i></span>
                <label for="defaultChannel">Enter twitch channel</label>
            <input type="text" id="defaultChannel" name="defaultChannel" >
            <label for="probMode">Jouer en mode YOLO (sandbox)</label><i class="fas fa-users"></i><i class="fas fa-users"></i><i class="fas fa-users"></i>
            <input type="radio" id="yoloMode" name="gameMode" value="normal">
            <br>
            <label for="probMode">Jouer en mode problèmes (ok but fix vote/reload issues)</label><i class="fas fa-cogs"></i>
            <input type="radio" id="probMode" name="gameMode" value="probMode">
            <div data-game-mode="probMode">
                <fieldset class="theme-filter-section">
                        <legend>Filtrage par thèmes</legend>
                        
                        <div class="filter-controls">
                            <button type="button" class="btn btn-secondary" onclick="selectAllThemes()">
                                Tout sélectionner
                            </button>
                            <button type="button" class="btn btn-danger" onclick="clearThemeFilter()">
                                Effacer la sélection
                            </button>
                        </div>
                        
                        <div class="problem-count" id="problemCount">
                            <span id="availableProblems">-</span>
                        </div>
                        
                        <div class="theme-list" id="themeList">
                            <!-- Les thèmes seront générés dynamiquement -->
                        </div>
                        
                        <div class="selected-themes" id="selectedThemes" style="display: none;">
                            <div id="selectedThemesTags"></div>
                        </div>
                        </fieldset>
                    </div>
            <br>
                <label for="mod1vViewers">Seul contre tous (wip)</label><i class="fas fa-user"></i><i class="fas fa-users"></i>
            <input type="radio" id="mod1vViewers" name="gameMode" value="mod1vViewers">
            <div data-game-mode="mod1vViewers">
                <label for="mod1vViewersPlayer">Pseudo du joueur</label>
                <input type="text" id="mod1vViewersPlayer" name="mod1vViewersPlayer" >
                </div>
                <br>
                <label for="mod1v1">Un contre un (ok?)</label><i class="fas fa-user"></i><i class="fas fa-user"></i>
            <input type="radio" id="mod1v1" name="gameMode" value="mod1v1">
            <div data-game-mode="mod1v1">
                <label for="oneVsOneModeList0">Pseudo du Joueur1</label><input type="text" id="oneVsOneModeList0" name="oneVsOneModeList0">
                <label for="oneVsOneModeList1">Pseudo du Joueur2</label><input type="text" id="oneVsOneModeList1" name="oneVsOneModeList1">
              </div>
              <br>
                <label for="modStreamerChatvStreamerChat">Chat contre Chat (ok?)</label><i class="fas fa-users"></i><i class="fas fa-users"></i>
            <input type="radio" id="modStreamerChatvStreamerChat" name="gameMode" value="modStreamerChatvStreamerChat">
            <div data-game-mode="modStreamerChatvStreamerChat">
                <label for="streamerChatvStreamerChat0">Pseudo du Streamer1</label><input type="text" id="streamerChatvStreamerChat0" name="streamerChatvStreamerChat0">
                <label for="streamerChatvStreamerChat1">Pseudo du Streamer2</label><input type="text" id="streamerChatvStreamerChat1" name="streamerChatvStreamerChat1">
              </div>
            <label for="modViewersvViewers">Tous contre tous (id pair/impair)(ok but cringe)</label><i class="fas fa-users"></i><i class="fas fa-users"></i>
            <input type="radio" id="modViewersvViewers" name="gameMode" value="modViewersvViewers">


            <fieldset>
                <legend>Mode Vote !</legend> 
            <label for="timerMode">Activer le mode vote</label><i class="fas fa-clock"></i>
            <input type="checkbox" data-mode="timerMode" id="timerMode" name="timerMode">
            <div data-time-mode>
                <label for="InitialvoterTimer">Temps d'un tour</label><i class="fas fa-hourglass-half"></i>
                <input type="number" id="InitialvoterTimer" name="InitialvoterTimer" min="0"> s
                <br>                
                <label for="timerWheelAnimation">Animation de la roue </label><i class="fas fa-circle-notch"></i>
                <input type="number" id="timerWheelAnimation" name="timerWheelAnimation" min="0"> s
                <br>
                <label for="limitToOneVote">Vote unique</label><i class="fas fa-ban"></i>
                <input type="checkbox" id="limitToOneVote" name="limitToOneVote">
                <br>
                <label for="majorityMode">Majorité ? / (sinon tirage au sort)</label><i class="fas fa-balance-scale"></i>
                <input type="checkbox" id="majorityMode" name="majorityMode">               
            </div>
        </fieldset>         
            <fieldset>
                <legend>Options de timer</legend> 
                <label for="pauseAfterWinLose">Durée de la pause</label><i class="fas fa-hourglass-end"></i>
                <input type="number" id="pauseAfterWinLose" name="pauseAfterWinLose" min="0"> s
                <label for="timerMoveBot">Animation du bot</label><i class="fas fa-robot"></i>
                <input type="number" id="timerMoveBot" name="timerMoveBot" min="0"> s
                <br>
                <label for="timerMoveText">Animation du coup joué</label><i class="fas fa-file-alt"></i>
                <input type="number" id="timerMoveText" name="timerMoveText" min="0"> s
        </fieldset>
                <fieldset>
                    <legend>Restrictions d'accès</legend>
                    <label for="followMode">Mode followers uniquement</label><i class="fas fa-heart"></i>
                    <input type="checkbox" id="followMode" name="followMode">
                    <br>
                    <label for="subMode">Mode abonnés uniquement</label><i class="fas fa-crown"></i>
                    <input type="checkbox" id="subMode" name="subMode">
                    <br>
                    <small style="color: #aaa; font-size: 12px;">
                        Note: Les modérateurs, VIPs et le broadcaster peuvent toujours jouer
                    </small>
                </fieldset>
            <fieldset>
                <legend>Autres options</legend> 
            <label for="noBg">Supprimer le background (test sur OBS ?)</label><i class="fas fa-image"></i>
            <input type="checkbox" id="noBg" name="noBg">
            <label for="noEpilepsy">Mode anti epilepsie (supprime le switch de background)</label><i class="fas fa-image"></i>
            <input type="checkbox" id="noEpilepsy" name="noEpilepsy">    
        </fieldset>

        <button type="submit" class="form-btn">Sauvegarde + reload<i class="fas fa-save"></i></button>
    </form>
    <!-- Roue de Sélection (Wheel) -->
    <div id="chart" style="display: none;"></div>
    
    <!-- Contrôles du Jeu -->
    <div class="game-controls">
        <button id="startBtn" class="game-control-btn">
            <i class="fas fa-play"></i> Start
        </button>
        <button id="pauseBtn" class="game-control-btn">
            <i class="fas fa-pause"></i> Pause
        </button>
        <button id="resetBtn" class="game-control-btn">
            <i class="fas fa-redo"></i> Reset
        </button>
        <button id="openFormButton" class="game-control-btn">
            <i class="fas fa-cog"></i> Config
        </button>
    </div>
    
    <!-- Formulaire de Configuration (Modal) -->
    <div id="configForm" style="display: none;">
        <!-- Votre formulaire existant -->
    </div>
    
    <!-- Container pour les Phantoms -->
    <div class="phantomContainer"></div>
    
    <!-- Scripts -->
    <script src="js/client.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <script src="js/tmi.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
    <script src="twitchToken.js"></script>
    
    <!-- Vos scripts JS -->
    <script src="js/config.js"></script>
    <script src="js/chessVoterApp.js"></script>
    <!-- Autres scripts... -->
    <script>
    	/**
 * MODAL-HANDLER.JS - Gestion de l'ouverture/fermeture du formulaire de configuration
 * Ajoutez ce script dans votre HTML ou dans un fichier JS séparé
 */

document.addEventListener('DOMContentLoaded', function() {
    
    // Éléments
    const configForm = document.getElementById('configForm');
    const openButton = document.getElementById('openFormButton');
    
    // Créer le backdrop s'il n'existe pas
    let backdrop = document.querySelector('.modal-backdrop');
    if (!backdrop) {
        backdrop = document.createElement('div');
        backdrop.className = 'modal-backdrop';
        document.body.appendChild(backdrop);
    }
    
    // Créer le bouton de fermeture s'il n'existe pas
    let closeButton = configForm.querySelector('.close-config');
    if (!closeButton) {
        closeButton = document.createElement('button');
        closeButton.className = 'close-config';
        closeButton.innerHTML = '×';
        closeButton.setAttribute('aria-label', 'Fermer');
        configForm.insertBefore(closeButton, configForm.firstChild);
    }
    
    // Fonction pour ouvrir le formulaire
    function openConfig() {
        configForm.style.display = 'block';
        configForm.classList.add('active');
        backdrop.classList.add('active');
        document.body.style.overflow = 'hidden'; // Empêche le scroll du body
    }
    
    // Fonction pour fermer le formulaire
    function closeConfig() {
        configForm.style.display = 'none';
        configForm.classList.remove('active');
        backdrop.classList.remove('active');
        document.body.style.overflow = ''; // Restaure le scroll
    }
    
    // Event listeners
    if (openButton) {
        openButton.addEventListener('click', function(e) {
            e.preventDefault();
            openConfig();
        });
    }
    
    // Fermer avec le bouton X
    if (closeButton) {
        closeButton.addEventListener('click', function(e) {
            e.preventDefault();
            closeConfig();
        });
    }
    
    // Fermer en cliquant sur le backdrop
    backdrop.addEventListener('click', function() {
        closeConfig();
    });
    
    // Fermer avec la touche Escape
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && configForm.classList.contains('active')) {
            closeConfig();
        }
    });
    
    // Empêcher la fermeture quand on clique dans le formulaire
    configForm.addEventListener('click', function(e) {
        e.stopPropagation();
    });
    
    // Si vous avez des boutons Save/Cancel dans le formulaire
    const saveButton = configForm.querySelector('.save-config');
    const cancelButton = configForm.querySelector('.cancel-config');
    
    if (saveButton) {
        saveButton.addEventListener('click', function() {
            // Votre logique de sauvegarde ici
            console.log('Configuration sauvegardée');
            closeConfig();
        });
    }
    
    if (cancelButton) {
        cancelButton.addEventListener('click', function() {
            closeConfig();
        });
    }
    
    // ========== Gestion des autres boutons (si nécessaire) ==========
    
    // Bouton Reset
    const resetBtn = document.getElementById('resetBtn');
    if (resetBtn) {
        resetBtn.addEventListener('click', function() {
            if (confirm('Êtes-vous sûr de vouloir réinitialiser la partie ?')) {
                // Votre logique de reset ici
                console.log('Partie réinitialisée');
                location.reload(); // Ou votre méthode de reset
            }
        });
    }
    
    // Si vous voulez réactiver les boutons Play/Pause
    const startBtn = document.getElementById('startBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    
    if (startBtn) {
        startBtn.style.display = 'none'; // Ou 'flex' pour afficher
    }
    
    if (pauseBtn) {
        pauseBtn.style.display = 'none'; // Ou 'flex' pour afficher
    }
});
    </script>
</body>
</html>